<!doctypehtml><html lang=en><meta charset=utf8><title>BlurHash SW</title><meta content="width=device-width,initial-scale=1"name=viewport><link href=./styles.css rel=stylesheet><link href=https://3846masa.github.io/blurhash-sw/ rel=canonical><meta content="The BlurHash API provided by ServiceWorker"name=description><meta content=website property=og:type><meta content=https://3846masa.github.io/blurhash-sw/ property=og:url><meta content="BlurHash SW"property=og:title><meta content="The BlurHash API provided by ServiceWorker"property=og:description><meta content=https://3846masa.github.io/blurhash-sw/assets/banner.jpg property=og:image><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content=summary_large_image name=twitter:card><meta content=https://3846masa.github.io/blurhash-sw/assets/banner.jpg name=twitter:image><div class=markdown-body><h1>BlurHash SW</h1><div class=image-wrapper style="width:-moz-fit-content;width:fit-content;background-color:#5a5e64;border-radius:8px;overflow:hidden;margin:0 auto 16px"data-blurhash=LKBg9{^jWBWV.Twwj[of57IUs:of><img alt="BlurHash SW"src="https://3846masa.github.io/blurhash-sw/assets/banner.jpg?__delay__=1000"height=630 loading=lazy style="width:600px;height:auto;margin:auto;opacity:0;transition:ease-out .3s opacity"width=1200 onload="this.style.opacity=1"></div><p><a href=https://www.npmjs.com/package/blurhash-sw><img alt=npm src=https://flat.badgen.net/npm/v/blurhash-sw></a> <a href=https://unpkg.com/blurhash-sw@1.0.15/dist/index.js><img alt=filesize src=https://flat.badgen.net/badgesize/gzip/file-url/unpkg.com/blurhash-sw@1.0.15/dist/index.js></a> <a href=https://3846masa.mit-license.org><img alt=license src=https://flat.badgen.net/badge/license/MIT/blue></a> <a href=https://github.com/RichardLitt/standard-readme><img alt="standard-readme compliant"src=https://flat.badgen.net/badge/readme%20style/standard/green></a><p>The BlurHash API provided by ServiceWorker.<p><a href=https://github.com/3846masa/blurhash-sw>https://github.com/3846masa/blurhash-sw</a><h2>Table of Contents</h2><ul><li><a href=#install>Install</a><li><a href=#usage>Usage</a><li><a href=#contributing>Contributing</a><li><a href=#license>License</a></ul><h2>Install</h2><p>Add the following code to your ServiceWorker script.<pre class=language-js><code class=language-js><span class="token comment">// sw.js</span>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'https://unpkg.com/blurhash-sw@1.0.15/dist/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">blurhashSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">routeUrl</span><span class="token operator">:</span> <span class="token string">'/.blurhash/:blurhash'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> <span class="token dom variable">navigator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">serviceWorker</span><span class="token punctuation">.</span><span class="token property-access function method">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#60/</span>script</span><span class="token punctuation">></span></span>
</code></pre><h2>Usage</h2><p>See also <a href=https://3846masa.github.io/blurhash-sw/>demo page</a>.<h3>The easiest way</h3><p>Set the BlurHash URL as <code>background-image</code>.<p>You should encode the BlurHash hash contained in the URL.<pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://source.unsplash.com/alY6_OpdwRQ/793x529<span class="token punctuation">"</span></span>
  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Shibuya 109<span class="token punctuation">"</span></span>
  <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>793<span class="token punctuation">"</span></span>
  <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>529<span class="token punctuation">"</span></span>
  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
    background-size: 100% 100%;
    background-image: url(/.blurhash/LGBEE%2CIr.At8t8IU-%3DR%2BR6R4OrIo);
  <span class="token punctuation">"</span></span></span>
  <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span>
</code></pre><img alt="Shibuya 109"src="https://source.unsplash.com/alY6_OpdwRQ/793x529?__delay__=3000"height=529 loading=lazy style="width:400px;height:auto;background-color:#0c5973;background-size:100% 100%;background-image:url(/.blurhash/LGBEE%2CIr.At8t8IU-%3DR%2BR6R4OrIo);color:transparent;margin:auto"width=793><h3>With fade-in transition</h3><p>Wrap the img element in the div element.<p>The BlurHash URL should be assigned as <code>background-image</code> of the div element.<pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
    width: fit-content;
    background-size: 100% 100%;
    background-image: url(/.blurhash/LKF%23tH-psS%2C%3F3%3FoJWVNbIVs.%24*n%24);
  <span class="token punctuation">"</span></span></span>
<span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
    <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://source.unsplash.com/7H77FWkK_x4/472x512<span class="token punctuation">"</span></span>
    <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tokyo tower<span class="token punctuation">"</span></span>
    <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>472<span class="token punctuation">"</span></span>
    <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>512<span class="token punctuation">"</span></span>
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
      opacity: 0;
      transition: ease-out 0.3s opacity;
    <span class="token punctuation">"</span></span></span>
    <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token language-javascript javascript value"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">opacity</span><span class="token operator">=</span><span class="token number">1</span></span><span class="token punctuation">"</span></span></span>
    <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#60/</span>div</span><span class="token punctuation">></span></span>
</code></pre><div class=image-wrapper style="width:-moz-fit-content;width:fit-content;background-color:#0c738c;background-size:100% 100%;background-image:url(/.blurhash/LKF%23tH-psS%2C%3F3%3FoJWVNbIVs.%24*n%24);margin:auto"><img alt="Tokyo tower"src="https://source.unsplash.com/7H77FWkK_x4/472x512?__delay__=3000"height=512 loading=lazy style="width:300px;height:auto;opacity:0;transition:ease-out .3s opacity"width=472 onload="this.style.opacity=1"></div><h3>Using <code>data-blurhash</code> attribute</h3><p>The BlurHash URL is not available until the ServiceWorker is ready.<p>Therefore, when visiting the site for the first time, <code>background-image</code> cannot be loaded.<p>As a workaround, generate <code>background-image</code> based on <code>data-blurhash</code> when the ServiceWorker is ready.<pre class=language-js><code class=language-js><span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">serviceWorker</span>
  <span class="token punctuation">.</span><span class="token property-access function method">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token property-access function method">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator arrow">=></span> <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">serviceWorker</span><span class="token punctuation">.</span><span class="token property-access">ready</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token property-access function method">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator arrow">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> $elemList <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access function method">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'[data-blurhash]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> $elem <span class="token keyword">of</span> $elemList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> blurhash <span class="token operator">=</span> $elem<span class="token punctuation">.</span><span class="token property-access">dataset</span><span class="token punctuation">.</span><span class="token property-access">blurhash</span><span class="token punctuation">;</span>
      $elem<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundSize</span> <span class="token operator">=</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">100% 100%</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span>
      $elem<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundImage</span> <span class="token operator">=</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">url(/.blurhash/</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>blurhash<span class="token punctuation">)</span><span class="token punctuation interpolation-punctuation">}</span></span><span class="token string">)</span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://source.unsplash.com/HkGaG67usNE/597x398<span class="token punctuation">"</span></span>
  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Kinkaku-ji<span class="token punctuation">"</span></span>
  <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>597<span class="token punctuation">"</span></span>
  <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span>
  <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span>
  <span class="token attr-name">data-blurhash</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>L%C%zEXANengKnkCj]n$NMjXsoW?<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span>
</code></pre><img alt=Kinkaku-ji src="https://source.unsplash.com/HkGaG67usNE/597x398?__delay__=3000"height=398 loading=lazy style=width:400px;height:auto;background-color:#0c8cd9;color:transparent;margin:auto width=597 data-blurhash=L%C%zEXANengKnkCj]n$NMjXsoW?><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
    width: fit-content;
  <span class="token punctuation">"</span></span></span>
  <span class="token attr-name">data-blurhash</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LmF~daR+NGWA_4RjRjWBkCadV@W;<span class="token punctuation">"</span></span>
<span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
    <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://source.unsplash.com/wPMvPMD9KBI/262x394<span class="token punctuation">"</span></span>
    <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Himeji castle<span class="token punctuation">"</span></span>
    <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>262<span class="token punctuation">"</span></span>
    <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>394<span class="token punctuation">"</span></span>
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>
      opacity: 0;
      transition: ease-out 0.3s opacity;
    <span class="token punctuation">"</span></span></span>
    <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token language-javascript javascript value"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">opacity</span><span class="token operator">=</span><span class="token number">1</span></span><span class="token punctuation">"</span></span></span>
    <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#60/</span>div</span><span class="token punctuation">></span></span>
</code></pre><div class=image-wrapper style=width:-moz-fit-content;width:fit-content;background-color:#262626;margin:auto data-blurhash=LmF~daR+NGWA_4RjRjWBkCadV@W;><img alt="Himeji castle"src="https://source.unsplash.com/wPMvPMD9KBI/262x394?__delay__=3000"height=394 loading=lazy style="width:300px;height:auto;opacity:0;transition:ease-out .3s opacity"width=262 onload="this.style.opacity=1"></div><h2>Contributing</h2><p>PRs accepted.<h2>License</h2><p><a href=https://3846masa.mit-license.org>MIT (c) 3846masa</a></div><script src=./index.js></script>